---
title: "p8105_hw2_cd3591"
author: "Anny"
date: "2025-09-29"
output: github_document
---

```{r}
# setup library
library(tidyverse)
library(readxl)
```

# Problem 1
```{r}
# read the pols-month data and clean it
pols_data = read_csv("pols-month.csv") %>%  
  janitor::clean_names() %>%
  separate(mon, into = c("year", "month", "day"), sep = "-") %>%  # separate mon into year, month and day by "-"
  mutate(year = as.integer(year),  # change year (character) variable into integer
         month = as.integer(month),  # change month (character) variable into integer
         day = as.integer(day), # change day (character) variable into integer
         month = month.name[month],  # replace month number with month name 
         president = if_else(prez_gop == 1, "gop", "dem") # create president variable taking values gop and dem
         ) %>%
  select(-prez_dem, -prez_gop, -day)  # remove prez_dem and prez_gop and the day variable

```

```{r}
# read the snp data and clean it
snp_data = read_csv("snp.csv") %>%
  janitor::clean_names() %>%
  mutate(date  = mdy(date),  # make the date into standard version
         date = if_else(date > Sys.Date(), date %m-% years(100), date)) %>%   # e.g. let 2068 into 1968
  separate(date, into = c("year", "month", "day"), sep = "-") %>%  # separate date into month, day and year by "-"
  mutate(year = as.integer(year),  # change year (character) variable into integer
         month = as.integer(month),  # change month (character) variable into integer
         day = as.integer(day), # change day (character) variable into integer
         month = month.name[month]  # replace month number with month name
         ) %>%
  select(-day) %>%  # remove the day variable
  relocate (year, month)  # make sure year and month are the leading columns
  
```

```{r}
# read the unemployment data and tidy it
unemployment_data = read_csv("unemployment.csv") %>%
  janitor::clean_names() %>%
  pivot_longer(
    -year, names_to = "month", values_to = "unemployment"  
    #except year variable, tidy names into month variable and values into unemployment variable
  ) %>%
  mutate(
    month = str_to_title(month), # capitalize the first letter of the month to match other datasets
    month = month.name[match(month, month.abb)]  # e.g. let "Jan" -> "January"
  )

# merge the datasets
merged_data = pols_data %>%
  left_join(snp_data, by = c("year", "month")) %>%
  left_join(unemployment_data, by = c("year", "month"))

```

```{r}
# export the cleaned datasets and the merged dataset
readr::write_csv(merged_data,   "merged_data.csv")
readr::write_csv(pols_data,     "pols_data.csv")
readr::write_csv(snp_data,      "snp_data.csv")
readr::write_csv(unemployment_data,  "unemployment_data.csv")
```

Description: 
pols_data.csv has 822 rows × 9 columns (year 1947-2015) with monthly counts of officeholders by party: gov_gop, sen_gop, rep_gop, gov_dem, sen_dem, rep_dem, plus the president variable indicates whether the president was democratic or republican on the associated date (dem = democratic; gop = republican). snp_data.csv has 787 × 3 (year 1950–2015) with year, month, close (the closing values of the S&P stock index). unemployment_data.csv has 816 × 3 (year 1948–2015) with year, month, unemployment (percentage of unemployment on the associate date). After merging all data sets, merged_data.csv contains 822 rows × 11 columns, spanning 1947–2015. Key variables are year, month, gov_gop, sen_gop, rep_gop, gov_dem, sen_dem, rep_dem, president, close, and unemployment (%). 

# Problem 2
```{r}
# read the Mr. Trash Wheel data
mr = read_excel("202409 Trash Wheel Collection Data.xlsx", 
                sheet = "Mr. Trash Wheel", 
                range = "A2:N655", 
                col_names = TRUE,
                na = c("", "NA")) %>% 
  janitor::clean_names() %>%  # use reasonable variable names
  drop_na(everything()) %>% # omit non-data entries
  filter(!is.na(dumpster)) %>%  # omit rows that do not include dumpster-specific data
  mutate(date = as.Date(date),
         year = as.integer(year),
         month = as.character(month),
         sports_balls = as.integer(round(as.numeric(sports_balls))),  
         #round the number of sports balls to the nearest integer and converts the result to an integer variable
         wheel = "Mr. Trash Wheel"  #keep track of Mr. Trash Wheel
         )  

# read the Professor Trash Wheel data
professor = read_excel("202409 Trash Wheel Collection Data.xlsx", 
                       sheet = "Professor Trash Wheel", 
                       range = "A2:M123", 
                       col_names = TRUE,
                       na = c("", "NA")) %>% 
  janitor::clean_names() %>%  # use reasonable variable names
  drop_na(everything()) %>% # omit non-data entries
  filter(!is.na(dumpster)) %>%  # omit rows that do not include dumpster-specific data
  mutate(date = as.Date(date),
         year = as.integer(year),
         month = as.character(month),
         wheel = "Professor Trash Wheel")  #keep track of Professor Trash Wheel

# read the Gwynnda Trash Wheel data
gwynnda = read_excel("202409 Trash Wheel Collection Data.xlsx", 
                     sheet = "Professor Trash Wheel", 
                     range = "A2:L266", 
                     col_names = TRUE,
                     na = c("", "NA")) %>% 
  janitor::clean_names() %>%  # use reasonable variable names
  drop_na(everything()) %>% # omit non-data entries
  filter(!is.na(dumpster)) %>%  # omit rows that do not include dumpster-specific data
  mutate(date = as.Date(date),
         year = as.integer(year),
         month = as.character(month),
         wheel = "Gwynnda Trash Wheel")  #keep track of Gwynnda Trash Wheel

# combine the datasets
trash = bind_rows(mr, professor, gwynnda)

# quick stats for inline use
n_observations  = nrow(trash)
n_variables = ncol(trash)
year_min = min(trash$year, na.rm = TRUE)
year_max = max(trash$year, na.rm = TRUE)

prof_total_weight = trash %>%
  filter(wheel == "Professor Trash Wheel") %>%
  summarize(total_tons = sum(weight_tons, na.rm = TRUE)) %>%
  pull()

gwy_june_2022_cigs <- trash %>%
  filter(wheel == "Gwynnda Trash Wheel", year == 2022, str_starts(month, "Jun")) %>%
  summarize(total_cigs = sum(cigarette_butts, na.rm = TRUE)) %>%
  pull()
```
The combined Trash Wheel data set contains `r n_observations` observations and `r n_variables` variables, during `r year_min`–`r year_max`. Each row is a dumpster load with date, month, year, total weight_tons, volume_cubic_yards, and item counts such as plastic_bottles, polystyrene, cigarette_butts, glass_bottles, plastic_bags, wrappers, and sports_balls, plus a wheel identifier indicating Mr., Professor, or Gwynnda. For the available data, Professor Trash Wheel collected `r round(prof_total_weight, 2)` tons of trash in total, and Gwynnda collected `r scales::comma(gwy_june_2022_cigs)` cigarette butts in June 2022.

# Problem 3
```{r}
# read the dataset
zip_info = read.csv("Zip Codes.csv")%>% 
  janitor::clean_names() # clean names
zori = read.csv("Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv")%>% 
  janitor::clean_names() # clean names

# tidy zori
zori_new = zori %>% pivot_longer(
  x2015_01_31:x2024_08_31, 
  names_to = "date",
  values_to = "ZORI",
  names_prefix = "x"
  ) %>%  # tidy the dates
  mutate(date = ymd(str_replace_all(date, "_", "-")),
         zip_code  = as.integer(region_name)
         ) 

# collapse zip_info to one row per ZIP to avoid many-to-many
zip_info_one = zip_info %>%
  mutate(zip_code = as.integer(zip_code)) %>%
  group_by(zip_code) %>%
  summarise(borough = first(county),
          neighborhood = str_c(sort(unique(neighborhood)), collapse = "; "),
          .groups = "drop")


#merge together
NY_zori = zori_new %>%
  left_join(zip_info_one,
            by = "zip_code") %>%
  arrange(zip_code, date) %>%
  relocate(zip_code, date, ZORI)




```
